<div class="personalized-container">
  <div class="row">
    <div class="col-md-8" data-wow-duration="1000ms" data-wow-delay="300ms">
      <div id="calendar"></div>
    </div>
    <div class="col-md-4" data-wow-duration="1000ms" data-wow-delay="300ms">
      <% if Option.where(user_id: current_user.id, vote: "pending").count == 0 %>
        <h2>No pending event options</h2>
      <% else %>
        <% @event_ids.each do |event_id| %>
          <%= form_tag "/option_proposals", method: :post do %>
            <h2><strong><%= Event.find(event_id).name %></strong></h2>
            <input type="hidden" name="event_id" value="<%= event_id %>">
            <p>From: <%= EventInvitation.find_by(event_id: event_id, mem_type: "owner").user.name.capitalize %></p>
            <% i = 0 %>
            <p><strong>Options</strong></p>
            <select class="multiselect" multiple="multiple" name = "option_ids[]">
              <% Option.where(event_id: event_id, user_id: current_user.id, vote: "pending").each do |time_option| %>
                <p><option value="<%= time_option.id %>"> <%= time_option.start.strftime("%a, %b %d %I:%M %P")%> - <%= time_option.end.strftime("%a, %b %d %I:%M %P") %></option></p>
              <% end %>
            </select>
            <input type="submit" class="btn btn-success" value="Vote">
            <hr>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function() {

  $('#calendar').fullCalendar(
    {
      // put your options and callbacks here
      header: {
        left:   'today prev,next',
        center: 'title',
        right:  'month,agendaWeek,agendaDay,listWeek'
      },
      events: 'events.json',
      eventRender: function(event, element) { 
        if (event.user) {
          element.find('.fc-title').append(" - " + event.user);
        }
      },
      selectable: true,
      selectHelper: true,
      dayClick: function(date, jsEvent, view) {
        if (view.name !== 'month') {
          return;
        }

        if (view.name === 'month') {
          $('#calendar').fullCalendar('changeView', 'agendaDay', {events: 'events.json'});
          $('#calendar').fullCalendar('gotoDate', date);
        }
      }
    }
  );

  $('.multiselect').multiselect();

});

</script>
